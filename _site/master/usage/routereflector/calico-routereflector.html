<!-- Set this_pages_navbar  -->












<!Doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="shortcut icon" type="image/png" href="/images/favicon.png">
    <link href='https://fonts.googleapis.com/css?family=Roboto:400,100,100italic,300,300italic,400italic,500,500italic,700,700italic,900,900italic' rel='stylesheet' type='text/css'>
    <link href="https://fonts.googleapis.com/css?family=Lato" rel="stylesheet">
    <link rel="stylesheet" href='https://fonts.googleapis.com/css?family=Roboto+Mono' type='text/css'>
    <link rel="stylesheet" href="/css/style.css"/>
    <link rel="stylesheet" href="/css/plugins/offcanvas.css"/>
    <link href="https://www.projectcalico.org/wp-content/themes/dante/css/font-awesome.min.css" rel="stylesheet">
    <script src="/js/jquery-2.2.0.min.js"></script>
    <script src="/js/bootstrap/bootstrap.min.js"></script>
    <script src="/js/script.js"></script>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-52125893-4', 'auto');
      ga('send', 'pageview');
    </script>
    <!-- Begin Jekyll SEO tag v2.4.0 -->
<title>Calico BIRD Route Reflector container</title>
<meta name="generator" content="Jekyll v3.7.2" />
<meta property="og:title" content="Calico BIRD Route Reflector container" />
<meta property="og:locale" content="en_US" />
<link rel="canonical" href="https://docs.projectcalico.org/v3.0/usage/routereflector/calico-routereflector" />
<meta property="og:url" content="https://docs.projectcalico.org/v3.0/usage/routereflector/calico-routereflector" />
<script type="application/ld+json">
{"headline":"Calico BIRD Route Reflector container","@type":"WebPage","url":"https://docs.projectcalico.org/v3.0/usage/routereflector/calico-routereflector","@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->

  </head>
  <body>
    <section>
      <nav id="toplevel-nav" class="navbar navbar-default navbar-static-top">
        <div class="container">
          <div class="navbar-header">
            <!-- Hamburger menu for mobile -->
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#tigera-navbar" aria-expanded="false" aria-controls="tigera-navbar">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
            <!-- Left brand image -->
            <a class="navbar-brand" href="https://projectcalico.org/">
              <img alt="Brand" src="/images/brand.png">
            </a>
          </div>
          <div id="tigera-navbar" class="navbar-collapse collapse">
            <ul class="nav navbar-nav navbar-right">
              <li><a href="https://projectcalico.org">Home</a></li>
              <li class="active"><a href="https://projectcalico.org/resources"><span>Resources</span></a>
                <ul>
                    <li><a href="/latest/getting-started/"><i class="fa fa-tachometer" aria-hidden="true"></i> &nbsp; Getting Started</a></li>
                    <li><a href=""><i class="fa fa-book" aria-hidden="true"></i> &nbsp; Documentation</a></li>
                    <!--<li><a href="https://www.projectcalico.org/tutorials"><i class="fa fa-file-code-o" aria-hidden="true"></i> &nbsp; Tutorials &amp; Examples</a></li>
                    <li><a href=""><i class="fa fa-paper-plane-o" aria-hidden="true"></i> &nbsp; Online Workshops</a></li>-->
                    <li><a href="https://www.projectcalico.org/videos"><i class="fa fa-video-camera" aria-hidden="true"></i> &nbsp; Videos &amp; Webinars</a></li>
                    <li><a href="https://www.projectcalico.org/training"><i class="fa fa-graduation-cap" aria-hidden="true"></i> &nbsp; Training</a></li>
                    <li><a href="/latest/releases/"><i class="fa fa-clock-o" aria-hidden="true"></i> &nbsp; Releases</a></li>
                    <!-- <li><a href="/mvp"><i class="fa fa-star" aria-hidden="true"></i> &nbsp; MVP Program</a></li> -->
                    <li><a href="https://www.projectcalico.org/blog"><i class="fa fa-bookmark" aria-hidden="true"></i> &nbsp; Blog</a></li>
                </ul>
              </li>
              <li><a href="https://www.projectcalico.org/community">Community</a>
                <ul>
                    <li><a href="https://slack.projectcalico.org/"><i class="fa fa-slack" aria-hidden="true"></i> &nbsp; Slack</a></li>
                    <!--<li><a href="https://stackoverflow.com/questions/tagged/project-calico" target="_blank"><i class="fa fa-stack-overflow" aria-hidden="true"></i> &nbsp; StackOverflow</a></li>-->
                    <li><a href="https://www.projectcalico.org/mvp"><i class="fa fa-star" aria-hidden="true"></i> &nbsp; MVP Program</a></li>
                    <li><a href="https://www.projectcalico.org/community#events"><i class="fa fa-calendar" aria-hidden="true"></i> &nbsp; Upcoming Events</a></li>
                    <li><a href="https://www.projectcalico.org/newsletters"><i class="fa fa-envelope-o" aria-hidden="true"></i> &nbsp; Newsletter</a></li>
                    <li><a href="https://github.com/projectcalico" target="_blank"><i class="fa fa-github" aria-hidden="true"></i> &nbsp; GitHub</a></li> 
                    <li><a href="https://www.projectcalico.org/jobs"><i class="fa fa-briefcase" aria-hidden="true"></i> &nbsp; Jobs</a></li>
                    <li><a href="https://www.projectcalico.org/blog"><i class="fa fa-bookmark" aria-hidden="true"></i> &nbsp; Blog</a></li>
                </ul>
              </li>
              <li><a href="https://www.projectcalico.org/mvp" style="font-weight: bold;">MVP</a></li>
              <li><a href="https://www.projectcalico.org/support">Support</a></li>
              <li class="hidden-xs"><a href="https://www.projectcalico.org/support">
                <img class="desktopImage" width="30" align="absmiddle" src="https://www.projectcalico.org/images/tigera_trans_sm.png" alt="Tigera"></a>
              </li>
            </ul>
            <form class="navbar-form visible-xs">
              <ul class="nav navbar-nav navbar-right">
                
                  <li >
                    <a href="/master/introduction">Introduction</a>
                  </li>
                
                  <li >
                    <a href="/master/getting-started">Getting Started</a>
                  </li>
                
                  <li  class="active">
                    <a href="/master/usage">Usage</a>
                  </li>
                
                  <li >
                    <a href="/master/reference">Reference</a>
                  </li>
                
                  <li >
                    <a href="/master/releases">Releases</a>
                  </li>
                
              </ul>
            </form>
            <ul class="visible-xs nav navbar-nav navbar-right">
             <li class="dropdown">
               <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Version (nightly)<span class="caret"></span></a>
               <ul class="dropdown-menu">
                 <li><a href="/v2.6/introduction">v2.6 (latest)</a></li>
                 <li><a href="/v2.5/introduction">v2.5</a></li>
                 <li><a href="/v2.4/introduction">v2.4</a></li>
                 <li><a href="/v2.3/introduction">v2.3</a></li>
                 <li><a href="/v2.2/introduction">v2.2</a></li>
                 <li><a href="/v2.1/introduction">v2.1</a></li>
                 <li><a href="/v2.0/introduction">v2.0</a></li>
                 <li><a href="/v1.6/introduction">v1.6</a></li>
                 <li><a href="/v1.5/introduction">v1.5</a></li>
                 <li><a href="/v3.0/introduction">v3.0 (beta)</a></li>
                 <li><a href="/master/introduction">nightly</a></li>
                 <li role="separator" class="divider"></li>
               </ul>
             </li>
           </ul>
          </div>
        </div>
        <div id="navbar" class="navbar-inverse navbar-collapse collapse">
          <div class="container">
            <ul class="nav navbar-nav">
              
                <li>
                  <a href="/master/introduction"><span>Introduction</span></a>
                </li>
              
                <li>
                  <a href="/master/getting-started"><span>Getting Started</span></a>
                </li>
              
                <li class="active">
                  <a href="/master/usage"><span>Usage</span></a>
                </li>
              
                <li>
                  <a href="/master/reference"><span>Reference</span></a>
                </li>
              
                <li>
                  <a href="/master/releases"><span>Releases</span></a>
                </li>
              
              <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Version (nightly)<span class="caret"></span></a>
                <ul class="dropdown-menu">
                   <li><a href="/v3.0/introduction">v3.0 (latest)</a></li>
                   <li><a href="/v2.6/introduction">v2.6</a></li>
                   <li><a href="/v2.5/introduction">v2.5</a></li>
                   <li><a href="/v2.4/introduction">v2.4</a></li>
                   <li><a href="/v2.3/introduction">v2.3</a></li>
                   <li><a href="/v2.2/introduction">v2.2</a></li>
                   <li><a href="/v2.1/introduction">v2.1</a></li>
                   <li><a href="/v2.0/introduction">v2.0</a></li>
                   <li><a href="/v1.6/introduction">v1.6</a></li>
                   <li><a href="/v1.5/introduction">v1.5</a></li>
                  <li role="separator" class="divider"></li>
                  <li><a href="/master/introduction">nightly</a></li>
                </ul>
              </li>
            </ul>
          </div>
          <div class="row">
            <div class="col-sm-0"></div>
          </div>
        </div>
      </nav>
      <div class="container">
        <div class="row row-offcanvas row-offcanvas-left">
          <p class="pull-left visible-xs">
            <button type="button" class="btn btn-primary btn-xs" data-toggle="offcanvas">Toggle nav</button>
          </p>
          <div class="col-xs-6 col-sm-4 col-md-3 sidebar-offcanvas">
            <div class="row">
              <script>
                (function() {
                  var cx = '015028447179048192876:xjzskk7awwe';
                  var gcse = document.createElement('script');
                  gcse.type = 'text/javascript';
                  gcse.async = true;
                  gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
                  var s = document.getElementsByTagName('script')[0];
                  s.parentNode.insertBefore(gcse, s);
                })();
              </script>
              <gcse:search></gcse:search>
            </div>
            <div id="sidebar">
            	

  
    
    
    <div class="link">
      <a class="item" data-title="Using Calico" href="/master/usage/">
        Using Calico
      </a>
    </div>
  

  
    
    <div>
      <div class="link">
        <span class="glyphicon glyphicon-chevron-right navbar-arrow"></span>
        <a role="button" data-toggle="collapse" href="#nav-calicoctl" aria-expanded="false" aria-controls="nav-calicoctl">
          calicoctl
        </a>
      </div>
      <div class="section">
        <div class="collapse" id="nav-calicoctl">
          

  
    
    
    <div class="link">
      <a class="item" data-title="Installing calicoctl" href="/master/usage/calicoctl/install">
        Installing calicoctl
      </a>
    </div>
  

  
    
    <div>
      <div class="link">
        <span class="glyphicon glyphicon-chevron-right navbar-arrow"></span>
        <a role="button" data-toggle="collapse" href="#nav-calicoctl-configuringcalicoctl" aria-expanded="false" aria-controls="nav-calicoctl-configuringcalicoctl">
          Configuring calicoctl
        </a>
      </div>
      <div class="section">
        <div class="collapse" id="nav-calicoctl-configuringcalicoctl">
          

  
    
    
    <div class="link">
      <a class="item" data-title="Overview" href="/master/usage/calicoctl/configure/">
        Overview
      </a>
    </div>
  

  
    
    
    <div class="link">
      <a class="item" data-title="etcd datastore options" href="/master/usage/calicoctl/configure/etcd">
        etcd datastore options
      </a>
    </div>
  

  
    
    
    <div class="link">
      <a class="item" data-title="Kubernetes API datastore options" href="/master/usage/calicoctl/configure/kdd">
        Kubernetes API datastore options
      </a>
    </div>
  


        </div>
      </div>
    </div>
  


        </div>
      </div>
    </div>
  

  
    
    
    <div class="link">
      <a class="item" data-title="Running calico/node with an init system" href="/master/usage/configuration/as-service">
        Running calico/node with an init system
      </a>
    </div>
  

  
    
    
    <div class="link">
      <a class="item" data-title="Configuring BGP Peers" href="/master/usage/configuration/bgp">
        Configuring BGP Peers
      </a>
    </div>
  

  
    
    <div>
      <div class="link">
        <span class="glyphicon glyphicon-chevron-right navbar-arrow"></span>
        <a role="button" data-toggle="collapse" href="#nav-routereflector" aria-expanded="false" aria-controls="nav-routereflector">
          Route Reflector
        </a>
      </div>
      <div class="section">
        <div class="collapse" id="nav-routereflector">
          

  
    
    
    <div class="link">
      <a class="item" data-title="Configuring BIRD" href="/master/usage/routereflector/bird-rr-config">
        Configuring BIRD
      </a>
    </div>
  

  
    
    
    <div class="link">
      <a class="item" data-title="The calico/routereflector container" href="/master/usage/routereflector/calico-routereflector">
        The calico/routereflector container
      </a>
    </div>
  


        </div>
      </div>
    </div>
  

  
    
    
    <div class="link">
      <a class="item" data-title="IPv6" href="/master/usage/ipv6">
        IPv6
      </a>
    </div>
  

  
    
    
    <div class="link">
      <a class="item" data-title="External Connectivity" href="/master/usage/external-connectivity">
        External Connectivity
      </a>
    </div>
  

  
    
    
    <div class="link">
      <a class="item" data-title="Configuring IP-in-IP" href="/master/usage/configuration/ip-in-ip">
        Configuring IP-in-IP
      </a>
    </div>
  

  
    
    
    <div class="link">
      <a class="item" data-title="Configuring a Node IP Address and Subnet" href="/master/usage/configuration/node">
        Configuring a Node IP Address and Subnet
      </a>
    </div>
  

  
    
    
    <div class="link">
      <a class="item" data-title="Configuring MTU" href="/master/usage/configuration/mtu">
        Configuring MTU
      </a>
    </div>
  

  
    
    
    <div class="link">
      <a class="item" data-title="Decommissioning a Node" href="/master/usage/decommissioning-a-node">
        Decommissioning a Node
      </a>
    </div>
  

  
    
    
    <div class="link">
      <a class="item" data-title="Configuring Conntrack" href="/master/usage/configuration/conntrack">
        Configuring Conntrack
      </a>
    </div>
  

  
    
    <div>
      <div class="link">
        <span class="glyphicon glyphicon-chevron-right navbar-arrow"></span>
        <a role="button" data-toggle="collapse" href="#nav-calicoforopenstack" aria-expanded="false" aria-controls="nav-calicoforopenstack">
          Calico for OpenStack
        </a>
      </div>
      <div class="section">
        <div class="collapse" id="nav-calicoforopenstack">
          

  
    
    
    <div class="link">
      <a class="item" data-title="Configuration" href="/master/usage/openstack/configuration">
        Configuration
      </a>
    </div>
  

  
    
    
    <div class="link">
      <a class="item" data-title="Detailed Semantics" href="/master/usage/openstack/semantics">
        Detailed Semantics
      </a>
    </div>
  

  
    
    
    <div class="link">
      <a class="item" data-title="Floating IPs" href="/master/usage/openstack/floating-ips">
        Floating IPs
      </a>
    </div>
  

  
    
    
    <div class="link">
      <a class="item" data-title="Service IPs" href="/master/usage/openstack/service-ips">
        Service IPs
      </a>
    </div>
  

  
    
    
    <div class="link">
      <a class="item" data-title="Host routes" href="/master/usage/openstack/host-routes">
        Host routes
      </a>
    </div>
  

  
    
    
    <div class="link">
      <a class="item" data-title="Kuryr" href="/master/usage/openstack/kuryr">
        Kuryr
      </a>
    </div>
  


        </div>
      </div>
    </div>
  

  
    
    
    <div class="link">
      <a class="item" data-title="Troubleshooting" href="/master/usage/troubleshooting/">
        Troubleshooting
      </a>
    </div>
  

  
    
    
    <div class="link">
      <a class="item" data-title="Logging" href="/master/usage/troubleshooting/logging">
        Logging
      </a>
    </div>
  

  
    
    
    <div class="link">
      <a class="item" data-title="Frequently Asked Questions" href="/master/usage/troubleshooting/faq">
        Frequently Asked Questions
      </a>
    </div>
  


			</div>
          </div>
          <div class="col-xs-12 col-sm-8 col-md-9">
            <div id="content-main">
              <!-- TOP DOCUMENTATION PAGE NAVBAR -->
              <div style="text-align: left; padding: 18px 0 9px 0; min-width: 500px; overflow-x: hidden;">
              
              <a data-proofer-ignore href="https://github.com/projectcalico/calico/tree/master/master/usage/routereflector/calico-routereflector.md" style="color: #999; text-decoration: none; float: right;" target="_blank"><i class="fa fa-github" aria-hidden="true"></i> Edit this page</a></div>
              <!-- END TOP DOCUMENTATION PAGE NAVBAR -->
              
  <div class="alert alert-warning" role="alert">
    <strong>Warning:</strong> You are viewing the master docs. <a href="/latest">Click here to view the docs for the latest release.</a>
  </div>


              <h1>Calico BIRD Route Reflector container</h1>
              <p>For many Calico deployments, the use of a Route Reflector is not required.
However, for large scale deployments a full mesh of BGP peerings between each
of your Calico nodes may become untenable.  In this case, route reflectors
allow you to remove the full mesh and scale up the size of the cluster.</p>

<p>This guide discusses the calico/routereflector image: a container image that
packages up the <code class="highlighter-rouge">BIRD</code> BGP daemon along with the <code class="highlighter-rouge">confd</code> templating engine to
provide a simple route reflector image which may be used for scaled-out Calico
deployments.</p>

<p>The image is currently experimental and has some key limitations discussed below.
However, it may provide a useful framework for future development.</p>

<p>These instructions are focused on container-based deployments that use the
<code class="highlighter-rouge">calico/node</code> container image.</p>

<p>For an OpenStack deployment, read <a href="bird-rr-config">Configuring BIRD as a BGP Route Reflector</a>.</p>

<blockquote class="alert alert-info">
  <p><strong>Note</strong>: The API and behavior of <code class="highlighter-rouge">calico/routereflector</code> is likely to change in
future releases.</p>
</blockquote>

<h4 id="known-limitations">Known limitations</h4>

<ul>
  <li>The <code class="highlighter-rouge">calico/routereflector</code> instance will automatically peer with the Calico
nodes, but it currently has no mechanism to configure peerings with non-Calico
BGP speakers (e.g. edge routers)</li>
  <li>There is no <code class="highlighter-rouge">calicoctl</code> integration or similar.</li>
  <li>If you are using Kubernetes API as the Calico datastore, the Route Reflector container
currently only supports running as a single-instance.</li>
  <li>For etcdv3, the Route Reflector container may be used to form a cluster of route reflectors that
automatically create a full mesh between each Route Reflector.
    <ul>
      <li>Note that there is no <code class="highlighter-rouge">calicoctl</code> integration and to form a cluster it is necessary to
configure data directly into the <code class="highlighter-rouge">etcd</code> datastore for each Route Reflector instance.</li>
      <li>It is not possible to form multiple separate meshed groups
of Route Reflectors using this image.</li>
    </ul>
  </li>
</ul>

<h2 id="starting-and-configuring-your-route-reflectors">Starting and configuring your route reflectors</h2>

<p>Follow the appropriate section to start and configure your route reflectors depending on
the datastore you are using for Calico:</p>

<ul>
  <li><a href="#using-etcdv3-as-the-calico-datastore">Using etcdv3 as the Calico datastore</a></li>
  <li><a href="#using-the-kubernetes-api-as-the-calico-datastore">Using the Kubernetes API as the Calico datastore</a></li>
</ul>

<h3 id="using-etcdv3-as-the-calico-datastore">Using etcdv3 as the Calico datastore</h3>

<h4 id="starting-a-route-reflector-instance">Starting a Route Reflector instance</h4>

<p>On your Route Reflector host, ensure you have <a href="http://www.docker.com">Docker v1.6</a> or greater
installed.</p>

<p>Run the following command to start the Route Reflector container image.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker run --privileged --net=host -d                              \
           -e IP=&lt;IPv4_RR&gt;                                         \
           [-e IP6=&lt;IPv6_RR&gt;]                                      \
           -e ETCD_ENDPOINTS=&lt;http://ETCD_IP:PORT&gt;                 \
           calico/routereflector:v0.5.0
</code></pre></div></div>

<p>Where:</p>

<ul>
  <li><code class="highlighter-rouge">[]</code> indicates an optional parameter</li>
  <li><code class="highlighter-rouge">&lt;IPv4_RR&gt;</code> is the IPv4 address of the RR host (the BIRD instance binds to
the hosts IPv4 address)</li>
  <li><code class="highlighter-rouge">&lt;IPv6_RR&gt;</code> is the <em>optional</em> IPv6 address of the RR host (the BIRD6 instance
binds to the hosts IPv6 address)</li>
  <li><code class="highlighter-rouge">&lt;ETCD_IP:PORT&gt;</code> is the colon separated IPv4 address and port of an etcd
node in the etcd cluster.  A comma-separated list of endpoints may be
specified.</li>
</ul>

<blockquote class="alert alert-info">
  <p><strong>Note</strong>: If you require TLS/SSL-enabled etcd, see the
<a href="#route-reflector-with-tlsssl-etcd">section below</a>
for details on how to start the route reflector.</p>
</blockquote>

<h4 id="route-reflector-with-tlsssl-etcd">Route Reflector with TLS/SSL Etcd</h4>

<p>If you are running secure etcd, you will need to pass in additional options
and set environment variables for the certificate and key files associated
with your etcd instance.</p>

<p>When starting the Route Reflector container image, you need to mount the
certificate files and environment variable filepaths for each file:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker run --privileged --net=host -d                              \
           -e IP=&lt;IPv4_RR&gt;                                         \
           [-e IP6=&lt;IPv6_RR&gt;]                                      \
           -e ETCD_ENDPOINTS=&lt;https://ETCD_IP:PORT&gt;                \
           -v &lt;FULL_PATH_TO_CERT_DIR&gt;:&lt;MOUNT_DIR&gt;                  \
           -e ETCD_CA_CERT_FILE=&lt;MOUNT_DIR&gt;/&lt;CA_FILE&gt;              \
           -e ETCD_CERT_FILE=&lt;MOUNT_DIR&gt;/&lt;CERT_FILE&gt;               \
           -e ETCD_KEY_FILE=&lt;MOUNT_DIR&gt;/&lt;KEY_FILE&gt;                 \
           calico/routereflector:v0.5.0
</code></pre></div></div>

<p>Where <code class="highlighter-rouge">&lt;FULL_PATH_TO_CERT_DIR&gt;</code> is a directory on the host that contains
the certificate files (you can mount multiple directories with additional
<code class="highlighter-rouge">-v &lt;DIR&gt;</code> parameters if they are in separate directories, but be sure
to choose different <code class="highlighter-rouge">&lt;MOUNT_DIR&gt;</code> locations if this is the case).</p>

<h3 id="using-the-kubernetes-api-as-the-calico-datastore">Using the Kubernetes API as the Calico datastore</h3>

<p>If you are using Kubernetes as the datastore for Calico, the Calico Route
Reflector container only supports running as a single route reflector.  It is not
possible with this image to set up a cluster of route reflectors.</p>

<h4 id="starting-up-the-route-reflector">Starting up the Route Reflector</h4>

<p>On your Route Reflector host, ensure you have <a href="https://docs.docker.com/engine/installation/">Docker v1.6</a> or greater
installed.</p>

<p>You will need a kubeconfig file that you need to mount into the route reflector
container.</p>

<p>Run the following command to start the Route Reflector container image.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker run --privileged --net=host -d                              \
           -e DATASTORE_TYPE=kubernetes                            \
           -e KUBECONFIG=/kubeconfig                               \
           -e IP=&lt;IPv4_RR&gt;                                         \
           -v &lt;KUBECONFIG FILE PATH&gt;:/kubeconfig                   \
           calico/routereflector:v0.5.0
</code></pre></div></div>

<p>Where:</p>

<ul>
  <li><code class="highlighter-rouge">&lt;IPv4_RR&gt;</code> is the IPv4 address of the RR host (the BIRD instance binds to
the hosts IPv4 address)</li>
  <li><code class="highlighter-rouge">&lt;KUBECONFIG FILE PATH&gt;</code> is the path to the kubeconfig file.</li>
</ul>

<p>When using Kubernetes API as the datastore, this route reflector image only works
as a single standalone reflector.</p>

<h2 id="configuring-calico-to-use-the-route-reflectors">Configuring Calico to use the route reflectors</h2>

<p>Run through this section  to set up the global Calico configuration
before configuring any nodes.  This only needs to be done once.</p>

<ul>
  <li>Disable the full node-to-node BGP mesh</li>
  <li>Configure the default node AS number for your network (this is used by
the Route Reflector image when setting up the Route Reflector full mesh).</li>
</ul>

<p>If you have a small cluster of Route Reflectors and you intend to have every
Calico Docker node peer with every Route Reflector, set this up one time as
global configuration.</p>

<h3 id="turn-off-the-full-node-to-node-mesh">Turn off the full node-to-node mesh</h3>

<p>From any Calico Docker node, run the following:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># Get the current bgpconfig settings
$ calicoctl get bgpconfig -o yaml &gt; bgp.yaml

# Set nodeToNodeMeshEnabled to false
$ vim bgp.yaml

# Replace the current bgpconfig settings
$ calicoctl replace -f bgp.yaml
</code></pre></div></div>

<h3 id="determine-the-as-number-for-your-network">Determine the AS number for your network</h3>

<p>From any Calico Docker node, run the following:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>calicoctl get nodes --output=wide
</code></pre></div></div>

<p>This returns table of all configured Calico node instances and includes the AS
number for each node.</p>

<h3 id="peering-with-every-route-reflector-optional">Peering with every Route Reflector (optional)</h3>

<p>If you have a small cluster of Route Reflectors (e.g. a single RR or a pair of
RRs for redundancy) and you intend to have every Calico Docker node peer with
each of the Route Reflectors, you can set up the peerings as a one-time set of
global configuration.</p>

<p>Use <code class="highlighter-rouge">calicoctl</code> to configure each route reflector as a global peer (i.e. it
peers with every node in the deployment):</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>calicoctl bgp peer add &lt;IP_RR&gt; as &lt;AS_NUM&gt;
$ calicoctl create -f - &lt;&lt; EOF
apiVersion: projectcalico.org/v3
kind: BGPPeer
metadata:
  name: bgppeer-global
spec:
  peerIP: &lt;IP_RR&gt;
  asNumber: &lt;AS_NUM&gt;
EOF
</code></pre></div></div>

<p>Where:</p>
<ul>
  <li><code class="highlighter-rouge">&lt;IP_RR&gt;</code> is the IPv4 or IPv6 address of the Route Reflector.</li>
  <li><code class="highlighter-rouge">&lt;AS_NUM&gt;</code> is the AS number to use for the network (set or determined
above).</li>
</ul>

<h2 id="setting-up-node-specific-peering">Setting up node-specific peering</h2>

<p>If you are deploying a cluster of Route Reflectors, with each Calico node
peering to a subset of Route Reflectors it will be necessary to set up the
peerings on a node-by-node basis.</p>

<p>This would be the typical situation when scaling out to a very large size.  For
example, you may have:</p>

<ul>
  <li>a cluster of 100 route reflectors connected in a full mesh</li>
  <li>a network of 100,000 Calico Docker nodes</li>
  <li>each Calico Docker node is connected to two or three different Route
Reflectors.</li>
</ul>

<h3 id="configuring-a-node-specific-route-reflector-peering">Configuring a node-specific Route Reflector peering</h3>

<p>To configure a Route Reflector as a peer of a specific node, run the following
<em>from the node</em>:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ cat &lt;&lt; EOF | calicoctl create -f -
apiVersion: projectcalico.org/v3
kind: BGPPeer
metadata:
  name: bgppeer-2
spec:
  peerIP: &lt;IP_RR&gt;
  node: &lt;NODENAME&gt;
  asNumber: &lt;AS_NUM&gt;
EOF
</code></pre></div></div>

<p>Where:</p>
<ul>
  <li><code class="highlighter-rouge">&lt;IP_RR&gt;</code> is the IPv4 or IPv6 address of the Route Reflector.</li>
  <li><code class="highlighter-rouge">&lt;AS_NUM&gt;</code> is the AS number to use for the network (set or determined
above).</li>
  <li><code class="highlighter-rouge">&lt;NODENAME&gt;</code> is the name of the node.</li>
</ul>

<p>Run this separately for each Route Reflector that you want to peer with the
node.</p>

              
              <!-- BOTTOM DOCUMENTATION PAGE NAVBAR -->
              <div style="margin-top: 60px; margin-bottom: 40px; padding-top: 20px; border-top: 1px solid #999; text-align: left; color: #999;">Rate this Page: <div class="rw-ui-container" style="margin-top: -5px;"></div> <a href="https://www.projectcalico.org/contact?type=docs&file=master/usage/routereflector/calico-routereflector.md" style="margin-left: 30px; color: #999; text-decoration: none;" target="_blank"><i class="fa fa-envelope" aria-hidden="true"></i> Provide Feedback</a> <a href="https://www.projectcalico.org/community#slack" style="margin-left: 30px; color: #999; text-decoration: none;" target="_blank"><i class="fa fa-slack" aria-hidden="true"></i> Get Help via Slack</a> <a href="https://www.projectcalico.org/mvp" style="margin-left: 30px; color: #999; text-decoration: none;" target="_blank"><i class="fa fa-trophy" aria-hidden="true"></i> Ask our MVPs</a> <a href="https:/tigera.io/training" style="margin-left: 30px; color: #999; text-decoration: none;" target="_blank"><i class="fa fa-graduation-cap" aria-hidden="true"></i> Training</a></div>
              <!-- END BOTTOM DOCUMENTATION PAGE NAVBAR -->
            </div>
          </div>
        </div>
      </div>
    </section>
    <!-- Start Visual Website Optimizer Asynchronous Code -->
    <script type='text/javascript'>
      var _vwo_code=(function(){
      var account_id=287573,
      settings_tolerance=2000,
      library_tolerance=2500,
      use_existing_jquery=false,
      /* DO NOT EDIT BELOW THIS LINE */
      f=false,d=document;return{use_existing_jquery:function(){return use_existing_jquery;},library_tolerance:function(){return library_tolerance;},finish:function(){if(!f){f=true;var a=d.getElementById('_vis_opt_path_hides');if(a)a.parentNode.removeChild(a);}},finished:function(){return f;},load:function(a){var b=d.createElement('script');b.src=a;b.type='text/javascript';b.innerText;b.onerror=function(){_vwo_code.finish();};d.getElementsByTagName('head')[0].appendChild(b);},init:function(){settings_timer=setTimeout('_vwo_code.finish()',settings_tolerance);var a=d.createElement('style'),b='body{opacity:0 !important;filter:alpha(opacity=0) !important;background:none !important;}',h=d.getElementsByTagName('head')[0];a.setAttribute('id','_vis_opt_path_hides');a.setAttribute('type','text/css');if(a.styleSheet)a.styleSheet.cssText=b;else a.appendChild(d.createTextNode(b));h.appendChild(a);this.load('//dev.visualwebsiteoptimizer.com/j.php?a='+account_id+'&u='+encodeURIComponent(d.URL)+'&r='+Math.random());return settings_timer;}};}());_vwo_settings_timer=_vwo_code.init();
    </script>
    <!-- End Visual Website Optimizer Asynchronous Code -->
    <!-- DOCUMENTATION RATING ANALYTICS -->
   <script type="text/javascript">(function(d, t, e, m){
    // Async Rating-Widget initialization.
    window.RW_Async_Init = function(){
        RW.init({
            huid: "368439",
            uid: "33da22c0dff384767b5074aaf10ebc50",
            source: "website",
            options: {
                "advanced": {
					"font": {
						"color": "#999999"
					},
                    "layout": {
                        "align": {
                            "hor": "left"
                        }
                    },
                    "text": {
                        "rateThis": "Rate this"
                    }
                },
				"label": {
					"background": "#FFFFFF"
				},
				"reVote": true,
				"showInfo": false,
				/*"showTooltip": false,*/
				"hideRecommendations": false,
				"showReport": false,
				"showLoader": false,
                "style": "oxygen",
                "isDummy": false
            } 
        });
        RW.render();
    };
        // Append Rating-Widget JavaScript library.
    var rw, s = d.getElementsByTagName(e)[0], id = "rw-js",
        l = d.location, ck = "Y" + t.getFullYear() + 
        "M" + t.getMonth() + "D" + t.getDate(), p = l.protocol,
        f = ((l.search.indexOf("DBG=") > -1) ? "" : ".min"),
        a = ("https:" == p ? "secure." + m + "js/" : "js." + m);
    if (d.getElementById(id)) return;              
    rw = d.createElement(e);
    rw.id = id; rw.async = true; rw.type = "text/javascript";
    rw.src = p + "//" + a + "external" + f + ".js?ck=" + ck;
    s.parentNode.insertBefore(rw, s);
    }(document, new Date(), "script", "rating-widget.com/"));</script>
    <!-- END DOCUMENTATION RATING ANALYTICS -->
  </body>
</html>
